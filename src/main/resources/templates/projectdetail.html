<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>项目详情</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" th:href="@{/css/bootstrap.css}">
</head>
<body style="background-color: #f7f7f7">
<input type="text"  th:value="${projectId}" style="display:none" id="projectId">
<input type="text"  th:value="${userId}" style="display:none" id="userId">
<div style="width: 1500px;min-height: 960px;margin: auto">
    <div class="col-lg-2" style="margin: 90px auto;background-color: #fff">
        <ul class="nav nav-pills nav-stacked">
            <ul class="nav nav-pills nav-stacked">
                <li  style="margin-top: 10px"><a href="showinfo">个人信息</a></li>
                <li ><a href="pubproject">发布项目</a></li>
                <li class="active"><a href="searchproject">寻找项目</a></li>
                <li ><a href="searchperson">寻找合伙人</a></li>
                <li ><a href="meproject">已创建项目</a></li>
                <li ><a href="signupproject">已报名项目</a></li>
                <li ><a href="message?flag=0">通知</a></li>
                <li ><a href="loginout">退出</a></li>
            </ul>
        </ul>
    </div>
    <div class="col-lg-10">
        <div style="margin: 90px auto;background-color:#ffffff;padding-bottom: 90px;border-radius: 5px">
            <div class="col-lg-6" style="padding-top: 20px">
                <form class="form-horizontal form-style" >
                    <div class="form-group">
                        <label class="col-sm-4 control-label">项目名称</label>
                        <div class="col-sm-8" style="line-height: inherit;text-align: center;vertical-align: middle;" id="title">

                        </div>
                    </div>
                    <div class="form-group">
                        <label  class="col-sm-4 control-label">发布人</label>
                        <div class="col-sm-8" style="line-height: inherit;text-align: center;vertical-align: middle;" id="name">

                        </div>
                    </div>
                    <div class="form-group">
                        <label  class="col-sm-4 control-label">创新创业导师</label>
                        <div class="col-sm-8" style="line-height: inherit;text-align: center;vertical-align: middle;" id="teacher">

                        </div>
                    </div>
                    <div class="form-group">
                        <label  class="col-sm-4 control-label">项目负责人</label>
                        <div class="col-sm-8" style="line-height: inherit;text-align: center;vertical-align: middle;" id="for_person">

                        </div>
                    </div>
                    <div class="form-group">
                        <label  class="col-sm-4 control-label">队员</label>
                        <div class="col-sm-8" style="line-height: inherit;text-align: center;vertical-align: middle;">
                            <table id="content">

                            </table>
                        </div>
                    </div>
                </form>
            </div>
            <div class="col-lg-6" style="padding-top: 20px">
                <form class="form-horizontal form-style" >

                    <div class="form-group">
                        <label  class="col-sm-4 control-label">比赛类型</label>
                        <div class="col-sm-8"style="line-height: inherit;text-align: center;vertical-align: middle;" id="type">

                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-4 control-label">比赛进度</label>
                        <div class="col-sm-8" style="line-height: inherit;text-align: center;vertical-align: middle;" id="process">

                        </div>
                    </div>
                    <div class="form-group">
                        <label  class="col-sm-4 control-label">项目简介</label>
                        <div class="col-sm-8" style="height:200px;margin-top:20px" id="introduce">

                        </div>
                    </div>
                    <div class="form-group">
                        <label  class="col-sm-4 control-label">寻找对象</label>
                        <div class="col-sm-8" style="line-height: inherit;text-align: center;vertical-align: middle;" id="find_num">

                        </div>
                    </div>
                </form>
            </div>

            <div>
                <form class="form-horizontal form-style" >
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button type="button" class="btn btn-default "  onclick="javascript:history.go(-1)" >返回</button>
                            <button type="button" class="btn btn-default " id="operator"style="margin-left: 300px" onclick="operation()">申请加入</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>
</body>
<script th:src="@{/js/jquery-3.3.1.min.js}"></script>
<script th:src="@{/js/bootstrap.js}" ></script>
<script>
    var projectId=0;
    var userId=0;
    $(function(){
        projectId=parseInt($("#projectId").val())
        getContent(projectId)
    })
    function getContent(id){
        $.ajax({
            "url":"/getsingleproject",
            "type":"POST",
            "dataType":"JSON",
            "data":{
                "projectId":id
            },
            "success":function (data) {
                if(data==false){
                    window.location.href="index"
                    return
                }
                if(data){
                    handledata(data.projectDetail,data.userList)
                    if(data.flag>0){
                        $("#operator").css("display","none")
                    }
                }
            }
        })
    }
    function handledata(projectDetail,userList){
        userId=projectDetail.userId;
        var name=projectDetail.name;
        var title=projectDetail.title;
        var findType=projectDetail.findType;
        var teacher=projectDetail.teacher;
        var leder=projectDetail.leder;
        var type=projectDetail.type;
        var typename="互联网+";
        if(type==1){
            typename="挑战杯"
        }else if(type==2){
            typename="创青春"
        }else if(type==3){
            typename="微软创青春"
        }
        var process=projectDetail.processType;
        var processname="校级";
        if(process==1){
            processname="省级";
        }else if(process==2){
            processname="国家级";
        }
        var introdution=projectDetail.findIntrodution;
        var findnum=projectDetail.findNum;
        $("#name").html(name)
        $("#title").html(title)
        if(teacher){
            $("#teacher").html(teacher)
        }else{
            $("#teacher").html("无")
        }
        $("#for_person").html(leder)
        $("#type").html(typename)
        $("#process").html(processname)
        $("#introduce").html(introdution)
        $("#find_num").html(findnum)
        if(userList){
            var url="<tbody></tbody>";
            $.each(userList,function(n,value){
                var user=value.user;
                var userDetail=value.userDetail
                var name=user.username;
                var major=userDetail.major;
                url+="<tr><td>"+name+"</td><td>"+major+"</td></tr>"
            })
            var url="</tbody>";
            $("#content").html(url)
        }
        var tempId=$("#userId").val()
        if(userId==tempId){
           $("#operator").css("display","none")
        }
    }
    function operation(){
        $.ajax({
            "url":"/application",
            "type":"POST",
            "dataType":"JSON",
            "data":{
                "projectId":projectId,
                "userId":userId,
                "type":0
            },
            "success":function (data) {
                if(data>0){
                    alert("申请已发送成功！")
                    window.location.href="searchproject"
                }
            }
        })
    }
</script>
</html>